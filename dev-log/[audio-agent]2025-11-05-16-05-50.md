# íŒŒì´í”„ë¼ì¸ í†µí•© ì‘ì—… ë¡œê·¸: ì˜¤ë””ì˜¤ ìƒì„± íŒŒì´í”„ë¼ì¸ ë¦¬íŒ©í„°ë§

**ì¼ì‹œ:** 2025-11-05 16:05:50
**ë‹´ë‹¹:** Claude Code (Audio Generation Agent)
**ì‘ì—… ë²”ìœ„:** ê³µí†µ ê²½ë¡œ í—¬í¼ í•¨ìˆ˜ í†µí•© ë° íŒŒì¼ëª… ê·œì¹™ í†µì¼

---

## ğŸ“ ì‘ì—… ìš”ì•½

`docs/commands/pipeline-integration.md`ì˜ ì§€ì‹œì— ë”°ë¼ ì˜¤ë””ì˜¤ ìƒì„± íŒŒì´í”„ë¼ì¸ì„ ë¦¬íŒ©í„°ë§í•˜ì—¬ `src/utils/path_sanitizer.py`ì˜ ê³µí†µ í—¬í¼ í•¨ìˆ˜ë¥¼ ì‚¬ìš©í•˜ë„ë¡ ë³€ê²½í–ˆìŠµë‹ˆë‹¤.

**ìƒˆë¡œìš´ íŒŒì¼ëª… ê·œì¹™:**
- ê³µë°± ìœ ì§€ (ì˜ˆ: "ì²­ì ìƒê°ìš´í•™ë¬¸ ë§¤ë³‘" â†’ "ì²­ì ìƒê°ìš´í•™ë¬¸ ë§¤ë³‘.mp3")
- íŠ¹ìˆ˜ë¬¸ì ì œê±° (ì˜ˆ: "ë¬¸í™”ì¬/ìœ ë¬¼ëª…" â†’ "ë¬¸í™”ì¬ìœ ë¬¼ëª….mp3")

---

## âœ… ì™„ë£Œëœ ì‘ì—…

### 1. ì½”ë“œ ë³€ê²½ ì‚¬í•­

#### `src/pipelines/audio_gen.py`

**ì œê±°ëœ ì½”ë“œ:**
```python
def _normalize_filename(keyword: str) -> str:
    """ê³µë°±ì„ ì–¸ë”ìŠ¤ì½”ì–´ë¡œ ì¹˜í™˜"""
    return keyword.replace(" ", "_")
```

**ì¶”ê°€ëœ import:**
```python
from src.utils.path_sanitizer import script_markdown_path, audio_output_path
```

**ë³€ê²½ëœ ê²½ë¡œ ìƒì„± ë¡œì§:**
```python
# ì´ì „ (ìˆ˜ë™ ê²½ë¡œ ìƒì„±)
slug = _normalize_filename(keyword)
script_filename = f"{slug}_script.md"
output_filename = f"{slug}.mp3"
script_path = script_dir / script_filename
output_path = output_dir / output_filename

# ì´í›„ (ê³µí†µ í—¬í¼ ì‚¬ìš©)
script_path = script_markdown_path(keyword, script_dir)
output_path = audio_output_path(keyword, output_dir)
```

**ì—…ë°ì´íŠ¸ëœ docstring:**
```python
Examples:
    >>> # ê¸°ë³¸ ì‚¬ìš©ë²• (ê³µë°±ì´ ìœ ì§€ë¨)
    >>> output_path = run("ì²­ì ìƒê°ìš´í•™ë¬¸ ë§¤ë³‘")
    >>> print(output_path)
    /path/to/outputs/audio/ì²­ì ìƒê°ìš´í•™ë¬¸ ë§¤ë³‘.mp3
```

---

## ğŸ§ª í…ŒìŠ¤íŠ¸ ê²°ê³¼

### í…ŒìŠ¤íŠ¸ 1: ê³µë°± ìœ ì§€ ê²€ì¦ âœ…
```bash
PYTHONPATH=. .venv/bin/python src/pipelines/audio_gen.py --keyword "ì²­ì ìƒê°ìš´í•™ë¬¸ ë§¤ë³‘" --dry-run
```

**ê²°ê³¼:**
- ì…ë ¥ ìŠ¤í¬ë¦½íŠ¸: `outputs/script/ì²­ì ìƒê°ìš´í•™ë¬¸ ë§¤ë³‘_script.md`
- ì¶œë ¥ íŒŒì¼: `outputs/audio/ì²­ì ìƒê°ìš´í•™ë¬¸ ë§¤ë³‘.mp3`
- **ê³µë°±ì´ ì •ìƒì ìœ¼ë¡œ ìœ ì§€ë¨** âœ…

### í…ŒìŠ¤íŠ¸ 2: ë‹¨ìˆœ í‚¤ì›Œë“œ âœ…
```bash
PYTHONPATH=. .venv/bin/python src/pipelines/audio_gen.py --keyword "í…ŒìŠ¤íŠ¸" --dry-run
```

**ê²°ê³¼:**
- ì¶œë ¥ íŒŒì¼: `outputs/audio/í…ŒìŠ¤íŠ¸.mp3`
- ì •ìƒ ì‘ë™ âœ…

### í…ŒìŠ¤íŠ¸ 3: íŠ¹ìˆ˜ë¬¸ì ì œê±° ê²€ì¦ âœ…
```bash
PYTHONPATH=. .venv/bin/python src/pipelines/audio_gen.py --keyword "ë¬¸í™”ì¬/ìœ ë¬¼ëª…" --dry-run
```

**ê²°ê³¼:**
- ì…ë ¥ í‚¤ì›Œë“œ: `"ë¬¸í™”ì¬/ìœ ë¬¼ëª…"`
- ì¶œë ¥ íŒŒì¼: `outputs/audio/ë¬¸í™”ì¬ìœ ë¬¼ëª….mp3`
- **ìŠ¬ë˜ì‹œ(/)ê°€ ì •ìƒì ìœ¼ë¡œ ì œê±°ë¨** âœ…

### í…ŒìŠ¤íŠ¸ 4: Python API í˜¸ì¶œ âœ…
```python
from src.pipelines import run_audio_generation
result = run_audio_generation(keyword='í…ŒìŠ¤íŠ¸', dry_run=True)
# ê²°ê³¼: /path/to/outputs/audio/í…ŒìŠ¤íŠ¸.mp3
```

**ê²°ê³¼:**
- `__init__.py`ì˜ exportê°€ ì •ìƒ ì‘ë™ âœ…
- Python ì½”ë“œì—ì„œ ì§ì ‘ í˜¸ì¶œ ê°€ëŠ¥ âœ…

---

## âš ï¸ í†µí•© ë¦¬ìŠ¤í¬ ë° ì£¼ì˜ì‚¬í•­

### 1. PYTHONPATH ì„¤ì • í•„ìˆ˜ âš ï¸

**ë¬¸ì œ:**
- `from src.utils.path_sanitizer import ...` í˜•íƒœì˜ ì ˆëŒ€ import ì‚¬ìš©
- Pythonì´ `src` ëª¨ë“ˆì„ ì°¾ê¸° ìœ„í•´ í”„ë¡œì íŠ¸ ë£¨íŠ¸ê°€ PYTHONPATHì— í¬í•¨ë˜ì–´ì•¼ í•¨

**í•´ê²° ë°©ë²•:**
```bash
# CLI ì‹¤í–‰ ì‹œ
PYTHONPATH=/path/to/project python src/pipelines/audio_gen.py --keyword "..."

# ë˜ëŠ” í”„ë¡œì íŠ¸ ë£¨íŠ¸ì—ì„œ ëª¨ë“ˆë¡œ ì‹¤í–‰
python -m src.pipelines.audio_gen --keyword "..."
```

**í†µí•© ì‹œ ê¶Œì¥ì‚¬í•­:**
- `src/main.py`ì—ì„œ ì˜¤ì¼€ìŠ¤íŠ¸ë ˆì´ì…˜í•  ë•ŒëŠ” ì´ë¯¸ PYTHONPATHê°€ ì„¤ì •ëœ ìƒíƒœì´ë¯€ë¡œ ë¬¸ì œì—†ìŒ
- ë…ë¦½ ì‹¤í–‰ ì‹œì—ëŠ” ì‚¬ìš©ìì—ê²Œ PYTHONPATH ì„¤ì • ì•ˆë‚´ í•„ìš”

### 2. íŒŒì¼ëª… ê·œì¹™ ì¼ê´€ì„± í™•ë³´ í•„ìš” ğŸ”„

**ì¤‘ìš”:**
- **ëª¨ë“  íŒŒì´í”„ë¼ì¸(info, script, audio)ì´ ë™ì¼í•œ `sanitize_keyword_for_path` í•¨ìˆ˜ë¥¼ ì‚¬ìš©í•´ì•¼ í•¨**
- í•œ íŒŒì´í”„ë¼ì¸ì´ë¼ë„ ë‹¤ë¥¸ ê·œì¹™ì„ ì‚¬ìš©í•˜ë©´ íŒŒì¼ì„ ì°¾ì§€ ëª»í•˜ëŠ” ì˜¤ë¥˜ ë°œìƒ

**ê²€ì¦ ë°©ë²•:**
```python
from src.utils.path_sanitizer import sanitize_keyword_for_path

# ëª¨ë“  íŒŒì´í”„ë¼ì¸ì´ ì´ í•¨ìˆ˜ë¥¼ ì‚¬ìš©í•´ì•¼ í•¨
keyword = "ì²­ì ìƒê°ìš´í•™ë¬¸ ë§¤ë³‘"
sanitized = sanitize_keyword_for_path(keyword)
# ê²°ê³¼: "ì²­ì ìƒê°ìš´í•™ë¬¸ ë§¤ë³‘" (ê³µë°± ìœ ì§€, íŠ¹ìˆ˜ë¬¸ìë§Œ ì œê±°)
```

### 3. ê¸°ì¡´ íŒŒì¼ê³¼ì˜ í˜¸í™˜ì„± âš ï¸

**ì ì¬ì  ë¬¸ì œ:**
- ì´ì „ ê·œì¹™(ê³µë°± â†’ ì–¸ë”ìŠ¤ì½”ì–´)ìœ¼ë¡œ ìƒì„±ëœ íŒŒì¼ì´ ìˆë‹¤ë©´ ì°¾ì§€ ëª»í•¨
- ì˜ˆ: ê¸°ì¡´ `ì²­ì_ìƒê°ìš´í•™ë¬¸_ë§¤ë³‘.mp3` â†’ ìƒˆ ê·œì¹™ìœ¼ë¡œëŠ” `ì²­ì ìƒê°ìš´í•™ë¬¸ ë§¤ë³‘.mp3`ë¥¼ ì°¾ìŒ

**ë§ˆì´ê·¸ë ˆì´ì…˜ ê¶Œì¥ì‚¬í•­:**
```bash
# ê¸°ì¡´ outputs ë””ë ‰í† ë¦¬ë¥¼ ë°±ì—…í•˜ê±°ë‚˜ ì‚­ì œ
mv outputs outputs_old
mkdir -p outputs/{info,script,audio}

# ë˜ëŠ” íŒŒì¼ëª… ì¼ê´„ ë³€ê²½
# (ì–¸ë”ìŠ¤ì½”ì–´ â†’ ê³µë°±)
```

### 4. ìš´ì˜ì²´ì œë³„ íŒŒì¼ëª… ê¸¸ì´ ì œí•œ ğŸ“

**macOS/Linux:**
- íŒŒì¼ëª… ìµœëŒ€ 255ë°”ì´íŠ¸
- UTF-8 í•œê¸€ì€ 1ê¸€ìë‹¹ 3ë°”ì´íŠ¸ â†’ ì•½ 85ì ì œí•œ

**Windows:**
- ê²½ë¡œ ì „ì²´ ìµœëŒ€ 260ì ì œí•œ
- ê¸´ ìœ ë¬¼ëª… ì‚¬ìš© ì‹œ ì£¼ì˜ í•„ìš”

**ê¶Œì¥ì‚¬í•­:**
- ë§¤ìš° ê¸´ í‚¤ì›Œë“œëŠ” ì‚¬ìš©ìì—ê²Œ ê²½ê³  ë˜ëŠ” ìë™ ì¶•ì•½

---

## ğŸ”„ í†µí•© í…ŒìŠ¤íŠ¸ ê³„íš

### Phase 1: ê°œë³„ íŒŒì´í”„ë¼ì¸ ê²€ì¦ (í˜„ì¬ ì™„ë£Œ)
- âœ… Audio pipeline ë¦¬íŒ©í„°ë§ ì™„ë£Œ
- â³ Info pipeline ë¦¬íŒ©í„°ë§ ëŒ€ê¸°
- â³ Script pipeline ë¦¬íŒ©í„°ë§ ëŒ€ê¸°

### Phase 2: End-to-End í…ŒìŠ¤íŠ¸
ëª¨ë“  íŒŒì´í”„ë¼ì¸ì´ ë¦¬íŒ©í„°ë§ ì™„ë£Œ í›„:

```bash
# ì „ì²´ íŒŒì´í”„ë¼ì¸ í…ŒìŠ¤íŠ¸
python src/main.py --keyword "ì²­ì ìƒê°ìš´í•™ë¬¸ ë§¤ë³‘"

# ì˜ˆìƒ ê²°ê³¼:
# 1. outputs/info/ì²­ì ìƒê°ìš´í•™ë¬¸ ë§¤ë³‘.md
# 2. outputs/script/ì²­ì ìƒê°ìš´í•™ë¬¸ ë§¤ë³‘_script.md
# 3. outputs/audio/ì²­ì ìƒê°ìš´í•™ë¬¸ ë§¤ë³‘.mp3
```

### Phase 3: ì—£ì§€ ì¼€ì´ìŠ¤ ê²€ì¦
```bash
# íŠ¹ìˆ˜ë¬¸ì í¬í•¨
python src/main.py --keyword "ìœ ë¬¼ëª…: ì„¤ëª…"

# ë§¤ìš° ê¸´ í‚¤ì›Œë“œ
python src/main.py --keyword "ë§¤ìš° ê¸´ ìœ ë¬¼ ì´ë¦„ í…ŒìŠ¤íŠ¸..."

# ì˜ë¬¸ + í•œê¸€ í˜¼í•©
python src/main.py --keyword "Goryeo ì²­ì"
```

---

## ğŸ“Š ë³€ê²½ ì˜í–¥ ë²”ìœ„

### ë³€ê²½ëœ íŒŒì¼
1. `src/pipelines/audio_gen.py` (ìˆ˜ì •)
   - `_normalize_filename` ì œê±° (-12ì¤„)
   - ê³µí†µ í—¬í¼ import ì¶”ê°€ (+2ì¤„)
   - ê²½ë¡œ ìƒì„± ë¡œì§ ê°„ì†Œí™” (-6ì¤„, +2ì¤„)
   - docstring ì—…ë°ì´íŠ¸

### ì˜ì¡´ì„± ì¶”ê°€
- `src/utils/path_sanitizer.py` (ê¸°ì¡´ íŒŒì¼ ì‚¬ìš©)

### í•˜ìœ„ í˜¸í™˜ì„±
- âš ï¸ **Breaking Change**: íŒŒì¼ëª… ê·œì¹™ ë³€ê²½ìœ¼ë¡œ ê¸°ì¡´ íŒŒì¼ê³¼ í˜¸í™˜ ì•ˆë¨
- ì´ì „ ë²„ì „ìœ¼ë¡œ ìƒì„±ëœ íŒŒì¼ì€ ìƒˆ ê·œì¹™ìœ¼ë¡œ ì°¾ì„ ìˆ˜ ì—†ìŒ

---

## ğŸ’¡ í–¥í›„ ê°œì„  ì œì•ˆ

### 1. íŒŒì¼ëª… ê²€ì¦ ìœ í‹¸ë¦¬í‹°
```python
def validate_keyword_length(keyword: str, max_chars: int = 85) -> None:
    """í‚¤ì›Œë“œ ê¸¸ì´ ê²€ì¦ (ìš´ì˜ì²´ì œ ì œí•œ ê³ ë ¤)"""
    if len(keyword) > max_chars:
        raise ValueError(f"í‚¤ì›Œë“œê°€ ë„ˆë¬´ ê¹ë‹ˆë‹¤ (ìµœëŒ€ {max_chars}ì)")
```

### 2. ë§ˆì´ê·¸ë ˆì´ì…˜ ìŠ¤í¬ë¦½íŠ¸
```python
# scripts/migrate_filenames.py
"""ê¸°ì¡´ íŒŒì¼ëª…ì„ ìƒˆ ê·œì¹™ìœ¼ë¡œ ì¼ê´„ ë³€ê²½"""
```

### 3. í†µí•© í…ŒìŠ¤íŠ¸ ìë™í™”
```python
# tests/test_pipeline_integration.py
def test_end_to_end_pipeline():
    """ì „ì²´ íŒŒì´í”„ë¼ì¸ í†µí•© í…ŒìŠ¤íŠ¸"""
```

---

## ğŸ“ ì²´í¬ë¦¬ìŠ¤íŠ¸

- [x] `_normalize_filename` í•¨ìˆ˜ ì œê±°
- [x] `path_sanitizer` í—¬í¼ í•¨ìˆ˜ import
- [x] ê²½ë¡œ ìƒì„± ë¡œì§ ë³€ê²½
- [x] docstring ë° ì£¼ì„ ì—…ë°ì´íŠ¸
- [x] dry_run ëª¨ë“œ í…ŒìŠ¤íŠ¸
- [x] ì‹¤ì œ í‚¤ì›Œë“œ í…ŒìŠ¤íŠ¸ (ê³µë°± ìœ ì§€ ê²€ì¦)
- [x] íŠ¹ìˆ˜ë¬¸ì ì œê±° ê²€ì¦
- [x] Python API í…ŒìŠ¤íŠ¸
- [x] í†µí•© ë¦¬ìŠ¤í¬ ë¬¸ì„œí™”

---

## ğŸ¯ í†µí•© ê°€ì´ë“œ

### ë‹¤ë¥¸ ì—ì´ì „íŠ¸ë¥¼ ìœ„í•œ ì•ˆë‚´

**Info Retrieval Agent:**
- `_sanitize_filename` â†’ `info_markdown_path(keyword, output_dir)` ì‚¬ìš©
- ì¶œë ¥: `outputs/info/{sanitized_keyword}.md`

**Script Generation Agent:**
- ì…ë ¥: `info_markdown_path(keyword, info_dir)`
- ì¶œë ¥: `script_markdown_path(keyword, output_dir)`

**Audio Generation Agent (í˜„ì¬):**
- ì…ë ¥: `script_markdown_path(keyword, script_dir)` âœ…
- ì¶œë ¥: `audio_output_path(keyword, output_dir)` âœ…

### Main ì˜¤ì¼€ìŠ¤íŠ¸ë ˆì´í„°ë¥¼ ìœ„í•œ ì•ˆë‚´

```python
# src/main.py ì˜ˆì‹œ
from src.pipelines import run_info_retrieval, run_script_generation, run_audio_generation

def run_pipeline(keyword: str):
    # 1. ì •ë³´ ê²€ìƒ‰
    info_path = run_info_retrieval(keyword)

    # 2. ìŠ¤í¬ë¦½íŠ¸ ìƒì„±
    script_path = run_script_generation(keyword)

    # 3. ì˜¤ë””ì˜¤ ìƒì„±
    audio_path = run_audio_generation(keyword)

    return audio_path
```

---

**ì‘ì—… ì™„ë£Œ ì‹œê°:** 2025-11-05 16:05:50
**ìƒíƒœ:** âœ… ì™„ë£Œ (í†µí•© í…ŒìŠ¤íŠ¸ ëŒ€ê¸°)
**ë‹¤ìŒ ë‹¨ê³„:** Info/Script íŒŒì´í”„ë¼ì¸ ë¦¬íŒ©í„°ë§ ì™„ë£Œ í›„ End-to-End í…ŒìŠ¤íŠ¸
